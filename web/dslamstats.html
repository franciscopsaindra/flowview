<html>
  <head>
	<meta http-equiv="efresh" content="5">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['line']});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'dslam');
        data.addColumn('number', 'current CDR rate');
        data.addColumn('number', 'mean CDR rate')
        // Sets chart options.
        var options = {
          width: 1000,
	      height: 500,
	      hAxis: {slantedText:true, slantedTextAngle:90 }
        };

        // Instantiates and draws our chart, passing in some options.
        var chart = new google.charts.Line(document.getElementById('mygraph'));
        $.getJSON("/cdrRate")
        	.done(function(jsData){
        		var rows = [];
		  		for(var i = 0; i < jsData.length; i++){
		  			rows.push([jsData[i].topElement.dslam, jsData[i].cdrRate, jsData[i].meanCdrRate]);
			  	}
				data.addRows(rows);
				chart.draw(data, options);
        	})
        	.fail(function(jqxhr, textStatus, error){
        		alert(error);
        	})
      }
    </script>
  </head>
  <body>
    <div id="mygraph"></div>
  </body>
</html>